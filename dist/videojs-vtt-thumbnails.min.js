/**
 * videojs-vtt-thumbnails
 * @version 0.0.13
 * @copyright 2019 Chris Boustead <chris@forgemotion.com>
 * @license MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],e):t.videojsVttThumbnails=e(t.videojs)}(this,function(r){"use strict";r=r&&r.hasOwnProperty("default")?r.default:r;!function(){function l(t){this.value=t}function t(r){var o,n;function a(t,e){try{var s=r[t](e),i=s.value;i instanceof l?Promise.resolve(i.value).then(function(t){a("next",t)},function(t){a("throw",t)}):h(s.done?"return":"normal",s.value)}catch(t){h("throw",t)}}function h(t,e){switch(t){case"return":o.resolve({value:e,done:!0});break;case"throw":o.reject(e);break;default:o.resolve({value:e,done:!1})}(o=o.next)?a(o.key,o.arg):n=null}this._invoke=function(i,r){return new Promise(function(t,e){var s={key:i,arg:r,resolve:t,reject:e,next:null};n?n=n.next=s:(o=n=s,a(i,r))})},"function"!=typeof r.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(t){return this._invoke("next",t)},t.prototype.throw=function(t){return this._invoke("throw",t)},t.prototype.return=function(t){return this._invoke("return",t)}}();var a=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(t[i]=s[i])}return t},o={},t=r.registerPlugin||r.plugin,e=function(s){var i=this;this.ready(function(){var t,e;t=i,e=r.mergeOptions(o,s),t.addClass("vjs-vtt-thumbnails"),t.vttThumbnails=new n(t,e)})},n=function(){function s(t,e){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),this.player=t,this.options=e,this.listenForDurationChange(),this.initializeThumbnails(),this.registeredEvents={},this}return s.prototype.src=function(t){this.resetPlugin(),this.options.src=t,this.initializeThumbnails()},s.prototype.detach=function(){this.resetPlugin()},s.prototype.resetPlugin=function(){this.thumbnailHolder&&this.thumbnailHolder.parentNode.removeChild(this.thumbnailHolder),this.progressBar&&this.progressBar.removeEventListener("mouseenter",this.registeredEvents.progressBarMouseEnter),this.progressBar&&this.progressBar.removeEventListener("mouseleave",this.registeredEvents.progressBarMouseLeave),this.progressBar&&this.progressBar.removeEventListener("mousemove",this.registeredEvents.progressBarMouseMove),delete this.registeredEvents.progressBarMouseEnter,delete this.registeredEvents.progressBarMouseLeave,delete this.registeredEvents.progressBarMouseMove,delete this.progressBar,delete this.vttData,delete this.thumbnailHolder,delete this.lastStyle},s.prototype.listenForDurationChange=function(){this.player.on("durationchange",function(){})},s.prototype.initializeThumbnails=function(){var e=this;if(this.options.src){this.options.imagesPerRow&&(this.options.imagePercentage=100/(this.options.imagesPerRow-1));var t=this.getBaseUrl(),s=this.getFullyQualifiedUrl(this.options.src,t);this.getVttFile(s).then(function(t){e.vttData=e.processVtt(t),e.setupThumbnailElement()})}},s.prototype.getBaseUrl=function(){return[window.location.protocol,"//",window.location.hostname,window.location.port?":"+window.location.port:"",window.location.pathname].join("").split(/([^\/]*)$/gi).shift()},s.prototype.getVttFile=function(i){var r=this;return new Promise(function(t,e){var s=new XMLHttpRequest;s.data={resolve:t},s.addEventListener("load",r.vttFileLoaded),s.open("GET",i),s.send()})},s.prototype.vttFileLoaded=function(){this.data.resolve(this.responseText)},s.prototype.setupThumbnailElement=function(t){var e=this,s=this.player.$(".vjs-mouse-display");this.progressBar=this.player.$(".vjs-progress-control");var i=document.createElement("div");i.setAttribute("class","vjs-vtt-thumbnail-display"),i.setAttribute("style","opacity: 0;"),this.time=document.createElement("div"),this.time.className="vjs-thumbnail-time",i.appendChild(this.time),this.time.innerHTML=this.player.currentTime(),this.progressBar.appendChild(i),this.thumbnailHolder=i,s&&s.classList.add("vjs-hidden"),this.registeredEvents.progressBarMouseEnter=function(){return e.onBarMouseenter()},this.registeredEvents.progressBarMouseLeave=function(){return e.onBarMouseleave()},this.progressBar.addEventListener("mouseenter",this.registeredEvents.progressBarMouseEnter),this.progressBar.addEventListener("mouseleave",this.registeredEvents.progressBarMouseLeave)},s.prototype.onBarMouseenter=function(){var e=this;this.mouseMoveCallback=function(t){e.onBarMousemove(t)},this.registeredEvents.progressBarMouseMove=this.mouseMoveCallback,this.progressBar.addEventListener("mousemove",this.registeredEvents.progressBarMouseMove),this.showThumbnailHolder()},s.prototype.onBarMouseleave=function(){this.registeredEvents.progressBarMouseMove&&this.progressBar.removeEventListener("mousemove",this.registeredEvents.progressBarMouseMove),this.hideThumbnailHolder()},s.prototype.getXCoord=function(t,e){var s=t.getBoundingClientRect(),i=document.documentElement;return e-(s.left+(window.pageXOffset||i.scrollLeft||0))},s.prototype.hmsToSecondsOnly=function(t){for(var e=t.split(":"),s=0,i=1;0<e.length;)s+=i*parseInt(e.pop(),10),i*=60;return s},s.prototype.onBarMousemove=function(t){this.updateThumbnailStyle(this.getXCoord(this.progressBar,t.clientX),this.progressBar.offsetWidth)},s.prototype.getStyleForTime=function(t){for(var e=0;e<this.vttData.length;++e){var s=this.vttData[e];if(t>=s.start&&t<s.end)return s.css}},s.prototype.showThumbnailHolder=function(){this.thumbnailHolder.style.opacity="1"},s.prototype.hideThumbnailHolder=function(){this.thumbnailHolder.style.opacity="0"},s.prototype.updateThumbnailStyle=function(t,e){var s=this.hmsToSecondsOnly(this.player.controlBar.progressControl.seekBar.mouseTimeDisplay.el_.innerText),i=a({},this.getStyleForTime(s));if(!i)return this.hideThumbnailHolder();this.options.mobile&&this.player.el_.offsetWidth<this.options.mobile.size&&(i.width=this.options.mobile.width+"px",i.height=this.options.mobile.height+"px"),this.player.isFullscreen()&&this.options.fullscreen&&this.player.el_.offsetWidth>=this.options.fullscreen.size&&(i.width=this.options.fullscreen.width+"px",i.height=this.options.fullscreen.height+"px"),this.time.innerHTML=this.player.controlBar.progressControl.seekBar.mouseTimeDisplay.el_.innerText;var r=Math.round((1-(e-t)/e)*e);this.thumbnailHolder.style.position="absolute";var o=parseInt(i.width)/2;if(r-5<o&&(o=r-5,r<5&&(o=0,r=5)),e-r-5<o&&(o=parseInt(i.width)-(e-r-5)),this.thumbnailHolder.style.left=r+"px",this.thumbnailHolder.style.marginLeft="-"+o+"px",!this.lastStyle||this.lastStyle!==i)for(var n in this.lastStyle=i)i.hasOwnProperty(n)&&(this.thumbnailHolder.style[n]=i[n])},s.prototype.processVtt=function(t){var a=this,h=[];return t.split(/[\r\n][\r\n]/i).forEach(function(t){if(t.match(/([0-9]{2}:)?([0-9]{2}:)?[0-9]{2}(.[0-9]{3})?( ?--> ?)([0-9]{2}:)?([0-9]{2}:)?[0-9]{2}(.[0-9]{3})?[\r\n]{1}.*/gi)){var e=t.split(/[\r\n]/i),s=e[0].split(/ ?--> ?/i),i=s[0],r=s[1],o=e[1],n=a.getVttCss(o);h.push({start:a.getSecondsFromTimestamp(i),end:a.getSecondsFromTimestamp(r),css:n})}}),h},s.prototype.getFullyQualifiedUrl=function(t,e){return 0<=t.indexOf("//")?t:0===e.indexOf("//")?[e.replace(/\/$/gi,""),this.trim(t,"/")].join("/"):0<e.indexOf("//")?[this.trim(e,"/"),this.trim(t,"/")].join("/"):t},s.prototype.getPropsFromDef=function(t){var e=t.split(/#xywh=/i),s=e[0],i=e[1].match(/[0-9]+/gi);return{x:i[0],y:i[1],w:i[2],h:i[3],image:s}},s.prototype.getVttCss=function(t){var e={},s=void 0;if(s=0<=this.options.src.indexOf("//")?this.options.src.split(/([^\/]*)$/gi).shift():this.getBaseUrl()+this.options.src.split(/([^\/]*)$/gi).shift(),!(t=this.getFullyQualifiedUrl(t,s)).match(/#xywh=/i))return e.background='url("'+t+'")',e;var i=this.getPropsFromDef(t);if(this.options.width&&this.options.height){var r=parseInt(i.x)/(parseInt(i.w)*this.options.imagesPerRow)*10;e.background='url("'+i.image+'") no-repeat',e.width=this.options.width+"px",e.height=this.options.height+"px",e.backgroundSize=100*this.options.imagesPerRow+"%",e.backgroundPosition=r*this.options.imagePercentage+"% 0"}else e.background='url("'+i.image+'") no-repeat -'+i.x+"px -"+i.y+"px",e.width=i.w+"px",e.height=i.h+"px";return e},s.prototype.doconstructTimestamp=function(t){var e=t.split("."),s=e[0].split(":");return{milliseconds:parseInt(e[1])||0,seconds:parseInt(s.pop())||0,minutes:parseInt(s.pop())||0,hours:parseInt(s.pop())||0}},s.prototype.getSecondsFromTimestamp=function(t){var e=this.doconstructTimestamp(t);return parseInt(3600*e.hours+60*e.minutes+e.seconds+e.milliseconds/1e3)},s.prototype.trim=function(t,e){var s=[" ","\n","\r","\t","\f","\v"," "," "," "," "," "," "," "," "," "," "," "," ","​","\u2028","\u2029","　"].join(""),i=0,r=0;for(t+="",e&&(s=(e+"").replace(/([[\]().?/*{}+$^:])/g,"$1")),i=t.length,r=0;r<i;r++)if(-1===s.indexOf(t.charAt(r))){t=t.substring(r);break}for(r=(i=t.length)-1;0<=r;r--)if(-1===s.indexOf(t.charAt(r))){t=t.substring(0,r+1);break}return-1===s.indexOf(t.charAt(0))?t:""},s}();return t("vttThumbnails",e),e.VERSION="0.0.13",e});